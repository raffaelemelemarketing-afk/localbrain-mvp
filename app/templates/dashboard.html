<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>LocalBrain â€” Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; background: #f5f6f8; margin: 0; }
    header { background: #1c3faa; color: #fff; padding: 1.2rem 2rem 1.6rem; }
    .topbar { display:flex; flex-wrap:wrap; align-items:center; gap:1.2rem; }
    .topbar h1 { margin:0; font-size:1.85rem; flex:1 1 auto; }
    nav { display:flex; gap:1rem; flex-wrap:wrap; }
    nav a { color:#fff; font-weight:600; text-decoration:none; padding:0.45rem 0.8rem; border-radius:999px; background:rgba(255,255,255,0.16); }
    nav a:hover { background:rgba(255,255,255,0.28); }
    main { padding: 1.5rem 2rem 3rem; max-width: 1240px; margin: 0 auto; }
    form.filters { display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1.5rem; align-items: flex-end; justify-content: center; }
    .filters label { min-width: 200px; }
    
    form.filters label { display: flex; flex-direction: column; font-size: 0.9rem; color: #24305a; }
    select, input[type="number"], input[type="checkbox"] { padding: 0.45rem 0.6rem; border: 1px solid #ccd4e0; border-radius: 6px; background: #fff; min-width: 180px; }
    .checkbox-label { flex-direction: row !important; align-items: center; gap: 0.5rem; font-weight: 600; color: #1f2a44; }
    .checkbox-label input[type="checkbox"] { min-width: auto; width: auto; }
    button { padding: 0.55rem 1.1rem; background: #1c3faa; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
    button:hover { background: #162f7a; }
    .layout { display: flex; align-items: flex-start; gap: 1.5rem; }
    .feed { flex: 1 1 0; max-width: 720px; }
    article { background: #fff; border-radius: 10px; padding: 1rem 1.25rem; margin-bottom: 1rem; box-shadow: 0 6px 18px -16px rgba(20,23,51,0.6); }
    article h3 { margin: 0 0 0.4rem 0; font-size: 1.1rem; }
    article h3 a { color: #1c3faa; text-decoration: none; }
    article h3 a:hover { text-decoration: underline; }
    .meta { font-size: 0.85rem; color: #5c6a85; margin-bottom: 0.6rem; }
    .summary { font-size: 0.95rem; color: #2f3644; line-height: 1.45; }
    .empty { background: #fff; border-radius: 10px; padding: 1.5rem; text-align: center; color: #5c6a85; }
    .ad-card { border: 1px dashed #c7cdf5; background: #edf0ff; }
    .ad-badge { display: inline-flex; align-items: center; gap: 0.35rem; background: #1c3faa; color: #fff; border-radius: 999px; padding: 0.25rem 0.65rem; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; }
    .ad-card h3 a { color: #0f172a; }
    .side-ads { width: 220px; position: sticky; top: 80px; display: flex; flex-direction: column; gap: 1rem; }
    .side-card { background: #fff; border-radius: 12px; padding: 1rem; box-shadow: 0 12px 28px -24px rgba(18, 31, 80, 0.65); border: 1px solid #e0e7ff; }
    .side-card h4 { margin: 0 0 0.4rem; font-size: 1rem; color: #0f172a; }
    .side-card p { margin: 0; font-size: 0.9rem; color: #1f2937; line-height: 1.4; }
    .side-card img { width: 100%; border-radius: 10px; margin-bottom: 0.6rem; object-fit: cover; }
    .side-card a { color: #1c3faa; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 0.3rem; margin-top: 0.6rem; }
    .side-card a:hover { text-decoration: underline; }
    .side-placeholder { background: #e5e7eb; border-radius: 12px; padding: 1rem; text-align: center; color: #6b7280; font-size: 0.9rem; }
    .offers-highlight { background:#fff; border-radius:12px; padding:1.2rem 1.5rem; box-shadow:0 14px 32px -30px rgba(28,63,170,0.7); margin-bottom:2rem; }
    .offers-highlight h2 { margin:0 0 0.8rem; font-size:1.25rem; color:#0f172a; }
    .offers-highlight p { margin:0 0 1.1rem; color:#475569; }
    .offers-list { display:grid; gap:0.9rem; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); }
    .offer-card { border:1px solid #e0e7ff; border-radius:10px; padding:0.9rem 1rem; background:#f8f9ff; }
    .offer-card h3 { margin:0 0 0.4rem; font-size:1.05rem; color:#1c3faa; }
    .offer-card .meta { font-size:0.8rem; color:#475569; margin-bottom:0.6rem; }
    .offer-card .contact { font-size:0.85rem; font-weight:600; color:#1f2937; }
    .offer-cta { margin-top:1rem; display:flex; gap:0.8rem; flex-wrap:wrap; }
    .offer-cta a { padding:0.55rem 1rem; border-radius:8px; font-weight:600; text-decoration:none; }
    .offer-cta a.primary { background:#1c3faa; color:#fff; }
    .offer-cta a.outline { border:1px solid #1c3faa; color:#1c3faa; background:#fff; }
    .ad-card img { width: 100%; border-radius: 10px; margin-bottom: 0.6rem; object-fit: cover; max-height: 160px; }
    @media (max-width: 640px) {
      form.filters label { width: 100%; }
      select, input[type="number"] { width: 100%; min-width: unset; }
      button { width: 100%; }
    }
    @media (max-width: 1024px) {
      .layout { flex-direction: column; }
      .feed { max-width: 100%; width: 100%; }
      .side-ads { display: none; }
    }
    .global-footer { background:#1c3faa; color:#f8fafc; padding:1.4rem 2rem; margin-top:3rem; }
    .global-footer .footer-inner { max-width:1100px; margin:0 auto; display:flex; flex-wrap:wrap; gap:1rem; align-items:center; justify-content:space-between; font-size:0.9rem; }
    .global-footer nav { display:flex; gap:1rem; flex-wrap:wrap; }
    .global-footer nav a { color:#ffffff; text-decoration:none; font-weight:600; background:rgba(255,255,255,0.18); padding:0.4rem 0.75rem; border-radius:999px; }
    .global-footer nav a:hover { background:rgba(255,255,255,0.28); }
  </style>
  <script src="/static/cookie-banner.js"></script>
</head>
<body>
  <header>
    <div class="topbar">
      <h1>LocalBrain â€” Feed Locale</h1>
      <nav>
        <a href="/dashboard">Dashboard</a>
        <a href="/offers">Bacheca servizi</a>
        <a href="/businesses">AttivitÃ  locali</a>
      </nav>
    </div>
    <p style="margin:0.3rem 0 0 0;">Notizie, autocandidature e opportunitÃ  dal territorio.</p>
  </header>
  <main>
    <form method="get" class="filters">
      <label>
        CittÃ 
        <select name="city">
          <option value="">Tutte</option>
          {% for c in cities %}
            <option value="{{ c }}" {{ "selected" if c == selected_city else "" }}>{{ c }}</option>
          {% endfor %}
        </select>
      </label>
      <label>
        Categoria
        <select name="category">
          <option value="">Tutte</option>
          {% for cat in categories %}
            <option value="{{ cat }}" {{ "selected" if cat == selected_category else "" }}>{{ cat }}</option>
          {% endfor %}
        </select>
      </label>
      <label>
        Limite
        <input type="number" name="limit" min="1" max="200" value="{{ limit }}">
      </label>
      <button type="submit">Filtra</button>
    </form>

        {% if featured_offers %}
    <section class="offers-highlight">
      <h2>Professionisti disponibili in zona</h2>
      <p>Una selezione curata di persone pronte a dare una mano. Guarda tutti gli annunci sulla <a href="/offers">bacheca</a>.</p>
      <div class="offers-list">
        {% for offer in featured_offers %}
          <div class="offer-card">
            {% if offer.image_url %}<img src="{{ offer.image_url }}" alt="{{ offer.title }}">{% endif %}
            <h3>{{ offer.title }}</h3>
            <div class="meta">{{ offer.category_label }} Â· {{ offer.city }}{% if offer.zone %} Â· {{ offer.zone }}{% endif %}</div>
            <p>{{ offer.description[:160] }}{% if offer.description|length > 160 %}â€¦{% endif %}</p>
            <div class="contact">{{ offer.contact_name }} â€“ {{ offer.contact_method }}{% if offer.rate %} Â· {{ offer.rate }}{% endif %}</div>
          </div>
        {% endfor %}
      </div>
      <div class="offer-cta">
        <a href="/offers" class="outline">Vai alla bacheca</a>
        <a href="/offers/new" class="primary">Pubblica il tuo annuncio</a>
      </div>
    </section>
    {% endif %}
</div>
    <div class="layout">
      {% set left_ad = sidebar_ads.left %}
      {% set right_ad = sidebar_ads.right %}

      <aside class="side-ads">
        {% if left_ad %}
          <div class="side-card">
            <div class="ad-badge">Sponsorizzato</div>
            {% if left_ad.image_url %}
              <img src="{{ left_ad.image_url }}" alt="{{ left_ad.title }}">
            {% endif %}
            <h4>{{ left_ad.title }}</h4>
            {% if left_ad.message %}
              <p>{{ left_ad.message }}</p>
            {% endif %}
            <a href="{{ left_ad.url }}" target="_blank" rel="noopener noreferrer">Scopri di piÃ¹ â†’</a>
          </div>
        {% else %}
          <div class="side-placeholder">Spazio sponsorizzato</div>
        {% endif %}
      </aside>

      <section class="feed">
        {% if items %}
          {% for item in items %}
            {% if item.type == "ad" %}
              <article class="ad-card">
                <div class="ad-badge">ðŸ”¸ Sponsorizzato</div>
                {% if item.image_url %}
                  <img src="{{ item.image_url }}" alt="{{ item.title }}">
                {% endif %}
                <h3><a href="{{ item.url }}" target="_blank" rel="noopener noreferrer">{{ item.title }}</a></h3>
                <div class="meta">{{ item.category or "tutte" }} Â· {{ item.city or "tutte le cittÃ " }}</div>
                {% if item.message %}
                  <p class="summary">{{ item.message }}</p>
                {% endif %}
              </article>
            {% else %}
              <article>
                <h3><a href="{{ item.url }}" target="_blank" rel="noopener noreferrer">{{ item.title }}</a></h3>
                <div class="meta">{{ item.category }} Â· {{ item.city }}{% if item.published_at %} Â· {{ item.published_at }}{% endif %}</div>
                {% if item.summary %}
                  <p class="summary">{{ item.summary }}</p>
                {% endif %}
              </article>
            {% endif %}
          {% endfor %}
        {% else %}
          <div class="empty">
            Nessun contenuto disponibile. Prova ad aggiornare le fonti o a modificare i filtri.
          </div>
        {% endif %}
      </section>

      <aside class="side-ads">
        {% if right_ad %}
          <div class="side-card">
            <div class="ad-badge">Sponsorizzato</div>
            {% if right_ad.image_url %}
              <img src="{{ right_ad.image_url }}" alt="{{ right_ad.title }}">
            {% endif %}
            <h4>{{ right_ad.title }}</h4>
            {% if right_ad.message %}
              <p>{{ right_ad.message }}</p>
            {% endif %}
            <a href="{{ right_ad.url }}" target="_blank" rel="noopener noreferrer">Scopri di piÃ¹ â†’</a>
          </div>
        {% else %}
          <div class="side-placeholder">Spazio sponsorizzato</div>
        {% endif %}
      </aside>
    </div>
  </main>
  <footer class="global-footer">
    <div class="footer-inner">
      <div>
        <span>Â© 2025 LocalBrain Fiumicino. Tutti i diritti riservati.</span>
        <span style="margin-left: 1rem; color: rgba(255,255,255,0.8);">
          <a href="/about-us" style="color: rgba(255,255,255,0.8); text-decoration: underline;">Chi Siamo</a> Â·
          <a href="/privacy-policy" style="color: rgba(255,255,255,0.8); text-decoration: underline;">Privacy</a> Â·
          <a href="/terms-conditions" style="color: rgba(255,255,255,0.8); text-decoration: underline;">Termini</a> Â·
          <a href="/disclaimer" style="color: rgba(255,255,255,0.8); text-decoration: underline;">Disclaimer</a>
        </span>
      </div>
      <nav>
        <a href="/businesses/new">Aggiungi attivitÃ </a>
        <a href="/offers/new">Pubblica annuncio</a>
        <a href="/ad-request">Richiedi pubblicitÃ </a>
        <a href="https://t.me/localbrain_fiumicino_bot" target="_blank" rel="noopener noreferrer">Telegram</a>
      </nav>
    </div>
  </footer>
</body>
</html>
